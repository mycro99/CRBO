<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Check Péremption - CS Oupeye</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #dc3545;
      --secondary-color: #6c757d;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --border-radius: 6px;
      --box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    #pdfContent {
      max-width: 900px;
      margin: auto;
    }
    h1, h2 {
      text-align: center;
      color: var(--primary-color);
    }
    h1 {
      margin-bottom: 20px;
    }
    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    .form-row > div {
      flex: 1;
      min-width: 150px;
    }
    .form-row label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
    }
    .form-row input {
      width: 100%;
      padding: 8px;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
    }
    th, td {
      border: 1px solid var(--secondary-color);
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: var(--primary-color);
      color: #fff;
    }
    .signature-container {
      margin-top: 20px;
      text-align: center;
    }
    .signature-pad {
      border: 1px solid var(--secondary-color);
      background-color: #fff;
      width: 100%;
      max-width: 400px;
      height: 100px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin: auto;
    }
    .button-container {
      text-align: center;
      margin-top: 30px;
    }
    .pdf-button {
      display: inline-block;
      padding: 12px 24px;
      font-size: 16px;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      box-shadow: var(--box-shadow);
    }
    .pdf-button:hover {
      background-color: #c82333;
    }
  </style>
  <!-- Inclusion de html2canvas et jsPDF via CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <div id="pdfContent">
    <h1>Check Péremption - CS Oupeye ©</h1>
    
    <!-- Informations de base -->
    <div class="form-row">
      <div>
        <label for="plaque">Plaque :</label>
        <input type="text" id="plaque" placeholder="Ex : AB-123-CD">
      </div>
      <div>
        <label for="date">Date :</label>
        <input type="date" id="date">
      </div>
      <div>
        <label for="heure">Heure :</label>
        <input type="time" id="heure">
      </div>
      <div>
        <label for="nom">Nom :</label>
        <input type="text" id="nom" placeholder="Nom">
      </div>
      <div>
        <label for="kilometrage">Kilométrage :</label>
        <input type="number" id="kilometrage" placeholder="Ex : 12345">
      </div>
    </div>
    
    <!-- Tableau de vérification (50 entrées générées dynamiquement) -->
    <h2>Tableau de vérification</h2>
    <table>
      <thead>
        <tr>
          <th>Entrée</th>
          <th>Date (mois/année)</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <!-- Les 50 lignes seront insérées ici par JavaScript -->
      </tbody>
    </table>
    
    <!-- Zone de signature tactile -->
    <h2>Signature</h2>
    <div class="signature-container">
      <canvas id="signaturePad" class="signature-pad"></canvas>
      <br>
      <button onclick="clearSignature('signaturePad')">Effacer la signature</button>
    </div>
    
    <!-- Bouton de génération du PDF -->
    <div class="button-container">
      <button class="pdf-button" onclick="generatePDF()">Générer PDF</button>
    </div>
  </div> <!-- Fin de #pdfContent -->

  <script>
     // Création d'un tableau contenant 50 libellés personnalisés
    const customLabels = [
      "Inspection Visuelle", "Contrôle Mécanique", "Vérification des Freins", 
      "Contrôle des Phares", "Test Électronique", "Vérification du Système Hydraulique",
      "Vérification Pneus", "Contrôle des Essuie-glaces", "Test Batterie", "Contrôle des Fluides",
      // Ajoute ici les libellés pour les entrées 11 à 50...
      "Libellé 11", "Libellé 12", "Libellé 13", "Libellé 14", "Libellé 15",
      "Libellé 16", "Libellé 17", "Libellé 18", "Libellé 19", "Libellé 20",
      "Libellé 21", "Libellé 22", "Libellé 23", "Libellé 24", "Libellé 25",
      "Libellé 26", "Libellé 27", "Libellé 28", "Libellé 29", "Libellé 30",
      "Libellé 31", "Libellé 32", "Libellé 33", "Libellé 34", "Libellé 35",
      "Libellé 36", "Libellé 37", "Libellé 38", "Libellé 39", "Libellé 40",
      "Libellé 41", "Libellé 42", "Libellé 43", "Libellé 44", "Libellé 45",
      "Libellé 46", "Libellé 47", "Libellé 48", "Libellé 49", "Libellé 50"
    ];

    // On sélectionne le <tbody> où insérer les lignes
    const tableBody = document.getElementById("tableBody");

    // Générer 50 lignes dans le tableau
    for (let i = 1; i <= 50; i++) {
      const row = document.createElement("tr");

      // Colonne pour le libellé personnalisé
      const cell1 = document.createElement("td");
      // Utilise le libellé du tableau customLabels, en vérifiant s'il existe, sinon utilise "Test " + i
      cell1.textContent = customLabels[i - 1] || "Test " + i;
      row.appendChild(cell1);

      // Colonne pour le champ de sélection du mois (calendrier)
      const cell2 = document.createElement("td");
      const inputMonth = document.createElement("input");
      inputMonth.type = "month"; // Ce champ ouvre un calendrier pour choisir le mois et l'année
      // Tu peux définir une valeur par défaut si besoin :
      // inputMonth.value = "2023-01";
      cell2.appendChild(inputMonth);
      row.appendChild(cell2);

      // Ajouter la ligne au <tbody>
      tableBody.appendChild(row);
    }

    // Fonction pour générer le PDF
    function generatePDF() {
      const element = document.getElementById('pdfContent');
      html2canvas(element, { useCORS: true, scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/jpeg", 1.0);
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();
        const imgProps = pdf.getImageProperties(imgData);
        const imgWidth = pageWidth;
        const imgHeight = (imgProps.height * imgWidth) / imgProps.width;
        let heightLeft = imgHeight;
        let position = 0;
        pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, 'JPEG', 0, position, imgWidth, imgHeight);
          heightLeft -= pageHeight;
        }
        pdf.save("check_peremption.pdf");
      });
    }

    // Fonction pour effacer la signature sur le canvas
    function clearSignature(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    // Initialisation de la signature tactile
    function initSignature(canvasId) {
      const canvas = document.getElementById(canvasId);
      const ctx = canvas.getContext("2d");
      let drawing = false;

      // Ajuster la taille du canvas en fonction de ses dimensions affichées
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;

      canvas.addEventListener("mousedown", function(e) {
        drawing = true;
        const rect = canvas.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(e.clientX - rect.left, e.clientY - rect.top);
      });
      canvas.addEventListener("mousemove", function(e) {
        if (drawing) {
          const rect = canvas.getBoundingClientRect();
          ctx.lineTo(e.clientX - rect.left, e.clientY - rect.top);
          ctx.stroke();
        }
      });
      canvas.addEventListener("mouseup", function() {
        drawing = false;
      });
      canvas.addEventListener("mouseout", function() {
        drawing = false;
      });

      canvas.addEventListener("touchstart", function(e) {
        e.preventDefault();
        drawing = true;
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        ctx.beginPath();
        ctx.moveTo(touch.clientX - rect.left, touch.clientY - rect.top);
      });
      canvas.addEventListener("touchmove", function(e) {
        e.preventDefault();
        if (drawing) {
          const touch = e.touches[0];
          const rect = canvas.getBoundingClientRect();
          ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
          ctx.stroke();
        }
      });
      canvas.addEventListener("touchend", function() {
        drawing = false;
      });
    }

    window.onload = function() {
      initSignature('signaturePad');
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Listing des Volontaires - Croix-Rouge&reg;</title>
  <link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary-color: #dc3545;
      --secondary-color: #6c757d;
      --bg-color: #f5f5f5;
      --text-color: #333;
      --border-radius: 6px;
      --box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 20px;
      background-color: var(--bg-color);
      color: var(--text-color);
    }
    /* Conteneur principal */
    #content {
      max-width: 1200px; /* Augmenté pour accueillir les colonnes larges */
      margin: auto;
      overflow-x: auto; /* Permet le défilement horizontal si nécessaire */
    }
    h1, h2 {
      text-align: center;
      color: var(--primary-color);
    }
    h1 {
      margin-bottom: 20px;
    }
    /* Zone de recherche */
    #searchContainer {
      text-align: center;
      margin-bottom: 20px;
    }
    #searchInput {
      width: 50%;
      padding: 8px;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    /* Bouton et conteneur déroulant du formulaire d'ajout */
    #addFormToggle {
      text-align: center;
      margin-bottom: 20px;
    }
    #addFormContainer {
      display: none;
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      background-color: #fff;
      box-shadow: var(--box-shadow);
    }
    #addFormContainer input[type="text"],
    #addFormContainer input[type="email"],
    #addFormContainer input[type="tel"],
    #addFormContainer input[type="date"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 10px;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }
    #addFormContainer label {
      font-weight: 500;
    }
    #addFormContainer .form-group {
      margin-bottom: 15px;
    }
    button, .pdf-button, #addFormContainer button {
      display: inline-block;
      padding: 12px 24px;
      font-size: 16px;
      background-color: var(--primary-color);
      color: #fff;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      box-shadow: var(--box-shadow);
      margin: 5px 0;
    }
    button:hover, .pdf-button:hover, #addFormContainer button:hover {
      background-color: #c82333;
    }
    /* Style du tableau */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background-color: #fff;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
      table-layout: auto;
    }
    th, td {
      padding: 12px;
      text-align: left;
      border: 1px solid var(--secondary-color);
      vertical-align: top;
    }
    th {
      background-color: var(--primary-color);
      color: #fff;
      font-weight: 500;
      position: relative; /* Nécessaire pour le handle de redimensionnement */
    }
    tr:nth-child(even) {
      background-color: #f9f9f9;
    }
    /* Largeur minimale pour certaines colonnes */
    #volunteerTable th:nth-child(3),
    #volunteerTable td:nth-child(3) {
      min-width: 250px; /* Colonne Email */
    }
    #volunteerTable th:nth-child(5),
    #volunteerTable td:nth-child(5) {
      min-width: 250px; /* Colonne Brevets */
    }
    /* Style pour une ligne inactive */
    .inactive {
      background-color: #e0e0e0 !important;
      color: #777;
    }
    /* Styles pour les inputs du tableau (édition) */
    .table-input {
      width: 100%;
      border: 1px solid var(--secondary-color);
      border-radius: var(--border-radius);
      padding: 4px;
      box-sizing: border-box;
    }
    /* Styles pour le handle de redimensionnement */
    .resizer {
      position: absolute;
      right: 0;
      top: 0;
      width: 5px;
      height: 100%;
      cursor: col-resize;
      user-select: none;
      background-color: transparent;
    }
    .resizer:hover {
      background-color: rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <div id="content">
    <h1>Listing des Volontaires - CS Oupeye&reg;</h1>

    <!-- Zone de recherche -->
    <div id="searchContainer">
      <input type="text" id="searchInput" placeholder="Rechercher...">
    </div>

    <!-- Bouton pour afficher/masquer le formulaire d'ajout -->
    <div id="addFormToggle">
      <button onclick="toggleAddForm()" class="pdf-button">Ajouter un Volontaire</button>
    </div>

    <!-- Formulaire d'ajout de volontaire (caché par défaut) -->
    <div id="addFormContainer">
      <form id="addForm" onsubmit="addVolunteer(event)">
        <h2>Ajouter un Volontaire</h2>
        <div class="form-group">
          <label for="newNom">Nom :</label>
          <input type="text" id="newNom" required>
        </div>
        <div class="form-group">
          <label for="newPrenom">Prénom :</label>
          <input type="text" id="newPrenom" required>
        </div>
        <div class="form-group">
          <label for="newEmail">Email :</label>
          <input type="email" id="newEmail" required>
        </div>
        <div class="form-group">
          <label for="newTel">Téléphone :</label>
          <input type="tel" id="newTel" required>
        </div>
        <div class="form-group">
          <label>Brevets :</label>
          <label><input type="checkbox" id="newBrevets_BEPS"> BEPS</label>
          <label><input type="checkbox" id="newBrevets_Secouriste"> Secouriste</label>
          <label><input type="checkbox" id="newBrevets_Atnup"> Atnup</label>
          <label><input type="checkbox" id="newBrevets_Amu"> Amu</label>
          <label><input type="checkbox" id="newBrevets_VIR"> VIR</label>
        </div>
        <div class="form-group">
          <label>FBSE :</label>
          <label><input type="radio" name="newFbse" value="NON" checked> NON</label>
          <label><input type="radio" name="newFbse" value="EN COURS"> EN COURS</label>
          <label><input type="radio" name="newFbse" value="OUI"> OUI</label>
        </div>
        <div class="form-group">
          <label>Permis de conduire :</label>
          <input type="checkbox" id="newPermis" checked>
        </div>
        <div class="form-group">
          <label>Sélection Médicale :</label>
          <label><input type="radio" name="newMedicale" value="NON" checked> NON</label>
          <label><input type="radio" name="newMedicale" value="OUI"> OUI</label>
          <br>
          <input type="date" id="newMedicaleDate" style="display:none;" placeholder="Date médicale">
        </div>
        <div class="form-group">
          <label>Actif :</label>
          <input type="checkbox" id="newActif" checked>
        </div>
        <button type="submit">Ajouter Volontaire</button>
      </form>
    </div>

    <!-- Tableau des volontaires -->
    <table id="volunteerTable">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Email</th>
          <th>Téléphone</th>
          <th>Brevets</th>
          <th>FBSE</th>
          <th>Actif</th>
          <th>Permis</th>
          <th>Sélection Médicale</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="volunteerTableBody">
        <!-- Les lignes seront générées dynamiquement -->
      </tbody>
    </table>
  </div>

  <script>
    // Structure de données pour les volontaires
    let volunteers = [];
    let rowCounter = 0; // Utilisé pour les groupes radio

    // Charge les données depuis le localStorage et reconstruit le tableau
    function loadVolunteers() {
      const data = localStorage.getItem("volunteersData");
      if (data) {
        volunteers = JSON.parse(data);
        rowCounter = volunteers.length;
      } else {
        // Exemple initial si aucun enregistrement n'existe
        volunteers = [{
          nom: "Dupont",
          prenom: "Jean",
          email: "jean.dupont@example.com",
          tel: "0123456789",
          brevets: { BEPS: true, Secouriste: true, Atnup: false, Amu: false, VIR: false },
          fbse: "NON",
          actif: true,
          permis: true,
          selection_medicale: { value: "NON", date: "" }
        }];
        rowCounter = 1;
      }
      buildTable();
    }

    // Sauvegarde le tableau des volontaires dans le localStorage
    function saveVolunteers() {
      localStorage.setItem("volunteersData", JSON.stringify(volunteers));
    }

    // Construit le tableau à partir des données
    function buildTable() {
      const tbody = document.getElementById("volunteerTableBody");
      tbody.innerHTML = "";
      volunteers.forEach((vol, index) => {
        const row = document.createElement("tr");
        row.setAttribute("data-index", index);
        if (!vol.actif) row.classList.add("inactive");
        row.innerHTML = `
          <td><input type="text" class="table-input vol-nom" value="${vol.nom}"></td>
          <td><input type="text" class="table-input vol-prenom" value="${vol.prenom}"></td>
          <td><input type="email" class="table-input vol-email" value="${vol.email}"></td>
          <td><input type="tel" class="table-input vol-tel" value="${vol.tel}"></td>
          <td>
            <label><input type="checkbox" class="vol-brevet" data-field="BEPS" ${vol.brevets.BEPS ? "checked" : ""}> BEPS</label><br>
            <label><input type="checkbox" class="vol-brevet" data-field="Secouriste" ${vol.brevets.Secouriste ? "checked" : ""}> Secouriste</label><br>
            <label><input type="checkbox" class="vol-brevet" data-field="Atnup" ${vol.brevets.Atnup ? "checked" : ""}> Atnup</label><br>
            <label><input type="checkbox" class="vol-brevet" data-field="Amu" ${vol.brevets.Amu ? "checked" : ""}> Amu</label><br>
            <label><input type="checkbox" class="vol-brevet" data-field="VIR" ${vol.brevets.VIR ? "checked" : ""}> VIR</label>
          </td>
          <td>
            <label><input type="radio" name="fbse_${index}" class="vol-fbse" value="NON" ${vol.fbse === "NON" ? "checked" : ""}> NON</label><br>
            <label><input type="radio" name="fbse_${index}" class="vol-fbse" value="EN COURS" ${vol.fbse === "EN COURS" ? "checked" : ""}> EN COURS</label><br>
            <label><input type="radio" name="fbse_${index}" class="vol-fbse" value="OUI" ${vol.fbse === "OUI" ? "checked" : ""}> OUI</label>
          </td>
          <td>
            <input type="checkbox" class="vol-actif" ${vol.actif ? "checked" : ""}>
          </td>
          <td>
            <input type="checkbox" class="vol-permis" ${vol.permis ? "checked" : ""}>
          </td>
          <td>
            <label>
              <input type="radio" name="medicale_${index}" class="vol-med" value="NON" ${vol.selection_medicale.value === "NON" ? "checked" : ""}> NON
            </label><br>
            <label>
              <input type="radio" name="medicale_${index}" class="vol-med" value="OUI" ${vol.selection_medicale.value === "OUI" ? "checked" : ""}> OUI
            </label><br>
            <input type="date" class="vol-med-date" value="${vol.selection_medicale.date}" style="${vol.selection_medicale.value === 'OUI' ? '' : 'display:none;'}">
          </td>
          <td>
            <button class="delete-btn">Supprimer</button>
          </td>
        `;
        tbody.appendChild(row);
      });
      attachTableEventListeners();
      saveVolunteers();
      // Ajoute les handles de redimensionnement aux en-têtes
      addResizers();
    }

    // Ajoute des écouteurs sur les inputs du tableau pour mettre à jour les données
    function attachTableEventListeners() {
      document.querySelectorAll("#volunteerTableBody tr").forEach(row => {
        const index = row.getAttribute("data-index");
        // Champs texte
        row.querySelectorAll(".vol-nom, .vol-prenom, .vol-email, .vol-tel").forEach(input => {
          input.addEventListener("input", function() {
            const field = this.classList.contains("vol-nom") ? "nom" :
                          this.classList.contains("vol-prenom") ? "prenom" :
                          this.classList.contains("vol-email") ? "email" : "tel";
            volunteers[index][field] = this.value;
            saveVolunteers();
          });
        });
        // Brevets
        row.querySelectorAll(".vol-brevet").forEach(checkbox => {
          checkbox.addEventListener("change", function() {
            const subfield = this.getAttribute("data-field");
            volunteers[index].brevets[subfield] = this.checked;
            saveVolunteers();
          });
        });
        // FBSE
        row.querySelectorAll(".vol-fbse").forEach(radio => {
          radio.addEventListener("change", function() {
            if (this.checked) {
              volunteers[index].fbse = this.value;
              saveVolunteers();
            }
          });
        });
        // Actif
        row.querySelector(".vol-actif").addEventListener("change", function() {
          volunteers[index].actif = this.checked;
          row.classList.toggle("inactive", !this.checked);
          saveVolunteers();
        });
        // Permis
        row.querySelector(".vol-permis").addEventListener("change", function() {
          volunteers[index].permis = this.checked;
          saveVolunteers();
        });
        // Sélection Médicale
        row.querySelectorAll(".vol-med").forEach(radio => {
          radio.addEventListener("change", function() {
            if (this.checked) {
              volunteers[index].selection_medicale.value = this.value;
              const dateInput = row.querySelector(".vol-med-date");
              if (this.value === "OUI") {
                dateInput.style.display = "block";
              } else {
                dateInput.style.display = "none";
                volunteers[index].selection_medicale.date = "";
                dateInput.value = "";
              }
              saveVolunteers();
            }
          });
        });
        row.querySelector(".vol-med-date").addEventListener("change", function() {
          volunteers[index].selection_medicale.date = this.value;
          saveVolunteers();
        });
        // Bouton Supprimer
        row.querySelector(".delete-btn").addEventListener("click", function() {
          deleteVolunteer(index);
        });
      });
    }

    // Fonction pour ajouter un nouveau volontaire depuis le formulaire
    function addVolunteer(event) {
      event.preventDefault();
      const newVol = {
        nom: document.getElementById("newNom").value,
        prenom: document.getElementById("newPrenom").value,
        email: document.getElementById("newEmail").value,
        tel: document.getElementById("newTel").value,
        brevets: {
          BEPS: document.getElementById("newBrevets_BEPS").checked,
          Secouriste: document.getElementById("newBrevets_Secouriste").checked,
          Atnup: document.getElementById("newBrevets_Atnup").checked,
          Amu: document.getElementById("newBrevets_Amu").checked,
          VIR: document.getElementById("newBrevets_VIR").checked
        },
        fbse: document.querySelector('input[name="newFbse"]:checked').value,
        actif: document.getElementById("newActif").checked,
        permis: document.getElementById("newPermis").checked,
        selection_medicale: {
          value: document.querySelector('input[name="newMedicale"]:checked').value,
          date: document.getElementById("newMedicaleDate").value
        }
      };
      volunteers.push(newVol);
      buildTable();
      document.getElementById("addForm").reset();
    }

    // Supprime un volontaire
    function deleteVolunteer(index) {
      volunteers.splice(index, 1);
      buildTable();
    }

    // Affichage/masquage du formulaire d'ajout
    function toggleAddForm() {
      const container = document.getElementById("addFormContainer");
      container.style.display = (container.style.display === "none" || container.style.display === "") ? "block" : "none";
    }

    // Filtre le tableau en temps réel
    document.getElementById("searchInput").addEventListener("keyup", function() {
      const filter = this.value.toLowerCase();
      document.querySelectorAll("#volunteerTable tbody tr").forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? "" : "none";
      });
    });

    // Affichage conditionnel du champ date dans le formulaire d'ajout
    document.querySelectorAll('input[name="newMedicale"]').forEach(radio => {
      radio.addEventListener("change", function() {
        const dateField = document.getElementById("newMedicaleDate");
        dateField.style.display = (this.value === "OUI") ? "block" : "none";
      });
    });

    // ---------------------------
    // Redimensionnement manuel des colonnes
    // ---------------------------
    function addResizers() {
      // Sélectionne tous les th de l'en-tête
      const ths = document.querySelectorAll("#volunteerTable th");
      ths.forEach(th => {
        // Supprime d'éventuels anciens handles
        const oldResizer = th.querySelector(".resizer");
        if (oldResizer) {
          oldResizer.remove();
        }
        // Crée un nouveau handle
        const resizer = document.createElement("div");
        resizer.className = "resizer";
        th.appendChild(resizer);
        resizer.addEventListener("mousedown", initResize);
      });
    }

    let currentTh, startX, startWidth;
    function initResize(e) {
      currentTh = e.target.parentElement;
      startX = e.clientX;
      startWidth = currentTh.offsetWidth;
      document.addEventListener("mousemove", resizeColumn);
      document.addEventListener("mouseup", stopResize);
    }
    function resizeColumn(e) {
      if (!currentTh) return;
      const newWidth = startWidth + (e.clientX - startX);
      currentTh.style.width = newWidth + "px";
    }
    function stopResize(e) {
      document.removeEventListener("mousemove", resizeColumn);
      document.removeEventListener("mouseup", stopResize);
      currentTh = null;
    }

    // Charger les volontaires au chargement de la page
    window.addEventListener("load", loadVolunteers);
  </script>
</body>
</html>
